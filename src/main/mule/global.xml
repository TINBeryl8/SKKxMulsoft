<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:api-gateway="http://www.mulesoft.org/schema/mule/api-gateway" xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns:db="http://www.mulesoft.org/schema/mule/db"
	xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/db http://www.mulesoft.org/schema/mule/db/current/mule-db.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/api-gateway http://www.mulesoft.org/schema/mule/api-gateway/current/mule-api-gateway.xsd">
	<configuration doc:name="Configuration" doc:id="cd4792a6-e622-4e39-8ebc-7c9306075a27" defaultErrorHandler-ref="globalError_Handler" />
	<configuration-properties doc:name="Configuration properties" doc:id="756b68bf-84d3-440f-8672-ce6fb2aa61be" file="${env}-config.yaml" />
	<db:config name="ODS_MSSQL" doc:name="Database Config" doc:id="e619b757-8330-41e5-bab1-fa2ea609c70c" >
		<db:mssql-connection host="${ods_database.host}" user="${ods_database.user}" password="${ods_database.pass}" databaseName="${ods_database.db_name}" />
	</db:config>
	<api-gateway:autodiscovery apiId="${autodiscovery.id}" ignoreBasePath="true" doc:name="API Autodiscovery" doc:id="97015ce8-71de-458f-b74f-57a59ae2c8cf" flowRef="smartsaleskit-system-api-main" />
	<error-handler name="globalError_Handler" doc:id="9370779d-414a-4259-9210-e1ba42447f57" >
		<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="a9c99f84-6d27-49df-9ebe-aaf328aa9795" type="ANY">
			<ee:transform doc:name="Transform Message" doc:id="9d99c071-7807-4a64-a83f-7cb988ecb4b7">
				<ee:message>
					<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
{
  "integrationStatusCode":"SSK_Integration_API",
  "integrationErrorMessage": error.description,
  "displayErrorMessage":  error.description,
}]]></ee:set-payload>
				</ee:message>
				<ee:variables>
					<ee:set-variable variableName="httpStatus"><![CDATA[500]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
		</on-error-propagate>
	</error-handler>
</mule>
